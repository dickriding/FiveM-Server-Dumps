var h=Object.defineProperty;var u=(l,e,t)=>e in l?h(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var a=(l,e,t)=>(u(l,typeof e!="symbol"?e+"":e,t),t);import{j as c,r as p,R as m,a as g,b as y}from"./vendor.ef189ada.js";const f=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const d of o.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&i(d)}).observe(document,{childList:!0,subtree:!0});function t(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerpolicy&&(o.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?o.credentials="include":s.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(s){if(s.ep)return;s.ep=!0;const o=t(s);fetch(s.href,o)}};f();const n=c.exports.jsx,r=c.exports.jsxs,w=c.exports.Fragment;class x extends p.exports.Component{constructor(e){super(e);a(this,"state",{url:"",playing:!1,loop:!1,controls:!1,width:"100%",height:"100%",pip:!1,time:0,progress:{},debug:!1,prevHost:null});a(this,"sendClientMessage",(e,t={})=>fetch(`https://rsm_media_player/${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}));a(this,"play",(e,t=0)=>{this.state.url&&this.setState({prevHost:new URL(this.state.url).host}),this.setState({url:e,playing:!0,hostname:new URL(e).hostname}),t>0&&this.seek(t)});a(this,"seek",e=>{this.player&&this.state.url&&this.player.seekTo(e)});a(this,"pause",e=>{this.setState({playing:!e})});a(this,"playerRef",e=>{this.player=e});a(this,"audioInit",(e,t)=>{this.audio.panner.panningModel="HRTF",this.audio.panner.distanceModel="linear",this.audio.panner.maxDistance=50,this.audio.panner.rolloffFactor=1,this.audio.panner.setPosition(e.x,e.y,e.z),this.audio.panner.setOrientation(t.x,t.y,t.z)});a(this,"audioData",(e,t,i)=>{const s=this.state.time;e.positionX>-14013e-49&&e.positionX<14013e-49?this.audio.ctx.listener.positionX.linearRampToValueAtTime(e.positionX,s+.05):this.audio.ctx.listener.positionX.exponentialRampToValueAtTime(e.positionX,s+.05),e.positionY>-14013e-49&&e.positionY<14013e-49?this.audio.ctx.listener.positionY.linearRampToValueAtTime(e.positionY,s+.05):this.audio.ctx.listener.positionY.exponentialRampToValueAtTime(e.positionY,s+.05),e.positionZ>-14013e-49&&e.positionZ<14013e-49?this.audio.ctx.listener.positionZ.linearRampToValueAtTime(e.positionZ,s+.05):this.audio.ctx.listener.positionZ.exponentialRampToValueAtTime(e.positionZ,s+.05),this.audio.ctx.listener.setOrientation(t.x,t.y,t.z,i.x,i.y,i.z)});a(this,"handleMessage",e=>{const t=e.data.type,i=e.data.args;if(!!t)switch(t){case"play":this.play(...i);break;case"stop":this.setState({url:"",playing:!1,hostname:null});break;case"setUuid":this.setState({uuid:i[0]});break;case"setAudioDistance":this.audio.panner.maxDistance=i[0];break;case"pause":this.pause(...i);break;case"isPaused":this.sendClientMessage("isPaused",{uuid:this.state.uuid,playing:!this.state.playing});break;case"getCurrentUrl":this.sendClientMessage("currentUrl",{uuid:this.state.uuid,url:this.state.url});break;case"seek":this.seek(...i);break;case"audioInit":this.audioInit(...i);break;case"audioData":this.audioData(...i);break;default:console.log("Unknown message: "+t)}});a(this,"handleProgress",e=>{this.setState({progress:e})});a(this,"handleReady",()=>{if(this.state.hostname.includes("twitch")){const e=setInterval(()=>{const t=document.getElementsByTagName("iframe")[0];if(typeof t!="undefined"&&t!==null){clearInterval(e);const i=t.contentDocument.querySelectorAll('[data-a-target="player-overlay-mature-accept"]');i.length!==0&&i[0].click();const s=this.player.getInternalPlayer();s.getMuted()&&s.setMuted(!1)}},500)}});a(this,"getSource",()=>{const e=document.getElementsByTagName("iframe")[0];return e?e.contentDocument.getElementsByTagName("video")[0]:document.getElementsByTagName("video")[0]});a(this,"handleStart",()=>{const e=new URL(this.state.url);this.state.prevHost!==e.host&&(this.audio.ctx.createMediaElementSource(this.getSource()).connect(this.audio.panner),this.audio.panner.connect(this.audio.compressor),this.audio.compressor.connect(this.audio.ctx.destination))});a(this,"handleEnd",()=>{this.sendClientMessage("onVideoEnd",{uuid:this.state.uuid,url:this.state.url}),this.setState({playing:!1,url:null})});a(this,"handleError",e=>{console.log(JSON.stringify(e)),this.sendClientMessage("error",{uuid:this.state.uuid,error:e.message})});const t=new window.AudioContext,i=t.createPanner(),s=t.listener,o=t.createDynamicsCompressor();this.audio={ctx:t,panner:i,listener:s,compressor:o}}componentDidMount(){this.sendClientMessage("ready"),window.addEventListener("message",this.handleMessage,!1)}componentWillUnmount(){window.removeEventListener("message",this.handleMessage,!1)}render(){var e;return window.debugPlayer=(t,i)=>{const s={data:{type:t,args:i}};this.handleMessage(s)},r("div",{className:"App",children:[this.state.debug&&r("div",{className:"debugMode",children:[n("h1",{style:{color:"#ff0000"},children:"Debug mode"}),n("button",{onClick:()=>this.play("https://www.youtube.com/watch?v=5-GkpxbZ9Zw"),children:"Play vid"}),this.state.url&&r(w,{children:[n("button",{onClick:()=>this.seek(50),children:"seek vid"}),r("button",{onClick:()=>this.pause(this.state.playing),children:[this.state.playing?"Pause":"Resume"," vid"]}),r("p",{children:[((e=this.state.progress.playedSeconds)!=null?e:0).toFixed(2),"s"]})]})]}),!this.state.url&&r("div",{className:"info",children:[n("h1",{children:"RSM Media Player"}),n("h2",{children:"If you are the owner of this player, use /play to play content"})]}),this.state.url&&r("div",{className:"player",children:[!this.state.playing&&n("div",{className:"paused",children:n("h1",{children:"PAUSED"})}),!this.state.hostname.includes("twitch")&&r("div",{className:"progressBar",children:[n("div",{className:"progress",style:{width:"100%",backgroundColor:"#000000"}}),n("div",{className:"progress",style:{width:`${this.state.progress.loaded*100}%`,backgroundColor:"#A4A7AB"}}),n("div",{className:"progress",style:{width:`${this.state.progress.played*100}%`,backgroundColor:"#ff0000"}})]}),n(m,{ref:this.playerRef,url:this.state.url,playing:this.state.playing,loop:this.state.loop,controls:this.state.controls,width:this.state.width,height:this.state.height,pip:this.state.pip,onReady:this.handleReady,onProgress:this.handleProgress,onStart:this.handleStart,onEnded:this.handleEnd,onError:this.handleError,config:{youtube:{playerVars:{autoplay:!0}},twitch:{options:{autoplay:!0,muted:!1}}}})]})]})}}g.render(n(y.StrictMode,{children:n(x,{})}),document.getElementById("root"));
